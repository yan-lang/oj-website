{% extends "oj/course/base.html" %}
{% load i18n %}
{% block title %}
    {{ assignment.name }}・{{ course.name }}
{% endblock %}

{% block stylesheet %}
    {{ block.super }}
    {% load static %}
    <link rel="stylesheet" href={% static 'css/markdown.css' %}>
{% endblock %}

{% block course_content %}
    <div class='col-assignment'>
        <div class='assignment-header'>
            <h2>{{ assignment.name }}</h2>
            <div class="assignment-header-status">
                {% if best_submission %}
                    {% if best_submission.grade == best_submission.total_grade %}
                        <svg width="1em" height="1em" viewBox="0 0 85 85" version="1.1"
                             xmlns="http://www.w3.org/2000/svg">
                            <g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                <g id="checkmark.circle.fill" transform="translate(-2891.000000, -618.000000)">
                                    <g id="Notes" fill="#FFFFFF" fill-rule="nonzero">
                                        <rect id="artboard" x="0" y="0" width="3300" height="2200"></rect>
                                    </g>
                                    <g id="Guides" transform="translate(263.000000, 625.000000)"
                                       stroke="#27AAE1"
                                       stroke-width="0.577">
                                        <line x1="0" y1="71" x2="2773" y2="71" id="Baseline-S"></line>
                                        <line x1="0" y1="0.541" x2="2773" y2="0.541" id="Capline-S"></line>
                                    </g>
                                    <g id="Symbols" transform="translate(498.000000, 618.000000)" fill="#20A85C"
                                       fill-rule="nonzero">
                                        <g id="Black-S" transform="translate(2392.570000, 0.000000)">
                                            <path d="M42.8281,84.78711 C65.9727,84.78711 84.8203,65.9395 84.8203,42.7949 C84.8203,19.6504 65.9727,0.8027 42.8281,0.8027 C19.6836,0.8027 0.83594,19.6504 0.83594,42.7949 C0.83594,65.9395 19.6836,84.78711 42.8281,84.78711 Z M37.7988,64.5234 C35.6504,64.5234 33.8926,63.4492 32.6719,62.082 L21.7344,49.582 C20.5137,48.2148 20.123,47.0918 20.123,45.6758 C20.123,42.5996 22.7109,40.1582 25.7383,40.1582 C27.4473,40.1582 28.7168,40.9395 29.8398,42.1113 L37.7988,50.998 L52.7402,27.5605 C54.1074,25.4609 55.6211,24.3867 57.7207,24.3867 C60.6992,24.3867 63.3848,26.6816 63.3848,29.709 C63.3848,30.7832 63.043,32.0039 62.2617,33.2246 L42.9746,61.6914 C41.8027,63.4004 39.8496,64.5234 37.7988,64.5234 Z"
                                                  id="形状"></path>
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </svg>
                        <span>{% trans "Passed" %} · {{ best_submission.grade }}/{{ best_submission.total_grade }}{% trans "Score" %}</span>
                    {% else %}
                        <svg width="1em" height="1em" viewBox="0 0 84 84" version="1.1"
                             xmlns="http://www.w3.org/2000/svg"
                             xmlns:xlink="http://www.w3.org/1999/xlink">
                            <g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                <g id="xmark.circle.fill" transform="translate(-2595.000000, -619.000000)">
                                    <g id="Notes" fill="#FFFFFF" fill-rule="nonzero">
                                        <rect id="artboard" x="0" y="0" width="3300" height="2200"></rect>
                                    </g>
                                    <g id="Guides" transform="translate(263.000000, 625.000000)" stroke="#27AAE1"
                                       stroke-width="0.577">
                                        <line x1="0" y1="71" x2="2773" y2="71" id="Baseline-S"></line>
                                        <line x1="0" y1="0.541" x2="2773" y2="0.541" id="Capline-S"></line>
                                    </g>
                                    <g id="Symbols" transform="translate(498.000000, 618.000000)" fill="#17A2B8"
                                       fill-rule="nonzero">
                                        <g id="Heavy-S" transform="translate(2096.470000, 1.000000)">
                                            <path d="M42.2422,83.15234 C64.9961,83.15234 83.5996,64.5488 83.5996,41.7949 C83.5996,19.041 64.9961,0.3887 42.1934,0.3887 C19.4395,0.3887 0.83594,19.041 0.83594,41.7949 C0.83594,64.5488 19.4395,83.15234 42.2422,83.15234 Z M30.4258,58.6406 C27.4961,58.6406 25.2988,56.4434 25.2988,53.4648 C25.2988,52.1465 25.8359,50.9258 26.8125,49.9492 L34.918,41.8438 L26.8125,33.7383 C25.8359,32.7617 25.2988,31.4922 25.2988,30.1738 C25.2988,27.2441 27.4961,25.0469 30.4258,25.0469 C31.9883,25.0469 33.209,25.4863 34.1855,26.5117 L42.1934,34.5195 L50.2988,26.5117 C51.3242,25.4863 52.4961,24.998 54.0586,24.998 C56.9883,24.998 59.1855,27.2441 59.1855,30.1738 C59.1855,31.4922 58.6484,32.7129 57.6719,33.6895 L49.5664,41.8438 L57.6719,49.9492 C58.6484,50.9258 59.1855,52.1465 59.1855,53.4648 C59.1855,56.4434 56.9395,58.6406 54.0586,58.6406 C52.4961,58.6406 51.2754,58.1523 50.25,57.1758 L42.1934,49.2168 L34.2344,57.1758 C33.209,58.2012 31.9883,58.6406 30.4258,58.6406 Z"
                                                  id="形状"></path>
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </svg>
                        <span>{% trans "In progress" %} · {{ best_submission.grade }}/{{ best_submission.total_grade }}{% trans "Score" %}</span>
                    {% endif %}
                {% else %}
                    <?xml version="1.0" encoding="UTF-8"?>
                    <svg width="1em" height="1em" viewBox="0 0 84 84" version="1.1" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="questionmark.circle.fill" transform="translate(-2595.000000, -619.000000)"
                               fill-rule="nonzero">
                                <g id="Notes" fill="#FFFFFF">
                                    <rect id="artboard" x="0" y="0" width="3300" height="2200"></rect>
                                </g>
                                <g id="Symbols" transform="translate(498.000000, 618.000000)" fill="#FFC107">
                                    <g id="Heavy-S" transform="translate(2096.470000, 1.000000)">
                                        <path d="M42.2422,83.15234 C64.9961,83.15234 83.5996,64.5488 83.5996,41.7949 C83.5996,19.041 64.9961,0.3887 42.1934,0.3887 C19.4395,0.3887 0.83594,19.041 0.83594,41.7949 C0.83594,64.5488 19.4395,83.15234 42.2422,83.15234 Z M41.2656,48.6309 C37.3594,48.6309 35.2109,47.1172 35.2109,44.1387 L35.2109,43.9922 C35.2109,41.4043 37.0664,39.5488 39.8496,37.6934 C42.8281,35.6426 44.5371,34.4219 44.5371,32.7617 C44.5371,31.2969 43.4629,30.3691 41.9004,30.3691 C40.6797,30.3691 39.752,30.9062 38.4336,32.127 C37.4082,33.1523 36.334,34.3242 33.6973,34.3242 C30.1328,34.3242 28.2773,32.3223 28.2773,29.832 C28.2773,28.9531 28.4727,28.1719 28.8145,27.3418 C30.5234,23.3379 35.748,20.6523 42.584,20.6523 C50.8359,20.6523 57.1348,25.291 57.1348,32.0781 C57.1348,36.2285 55.3281,38.4746 51.1289,41.0625 C49.1758,42.2832 47.418,43.5039 46.8809,45.0176 C46.832,45.1152 46.7832,45.2129 46.7832,45.3105 C46.002,47.2148 44.1465,48.6309 41.2656,48.6309 Z M41.5586,61.5703 C37.8477,61.5703 35.6016,59.6172 35.6016,56.4434 C35.6016,53.2207 37.8477,51.3652 41.5586,51.3652 C45.0742,51.3652 47.418,53.2695 47.418,56.4434 C47.418,59.666 45.123,61.5703 41.5586,61.5703 Z"
                                              id="形状"></path>
                                    </g>
                                </g>
                            </g>
                        </g>
                    </svg>
                    <span>{% trans "It seems that you have not started yet." %}</span>
                {% endif %}
            </div>
            {% if assignment.alert %}
                <div class="assignment-alert alert alert-primary alert-dismissible fade show mt-2" role="alert">
                    {{ assignment.alert | safe }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            {% endif %}
        </div>
        <table class='assignment-deadline-information'>
            <tbody>
            <tr>
                <td><strong>{% trans "Deadline" %}</strong></td>
                <td>
                    <div>
                        {% trans "The deadline of this assignment is" %}: {{ assignment.deadline | date:"DATETIME_FORMAT" }}
                    </div>
                    <div class="caption-text color-text-secondary">
                        {% if not pass_deadline %}
                            {% trans "You still have enough time to finish this assignment before the deadline." %}
                        {% else %}
                            {% trans "Sorry, you have passed the deadline. Please finish the assignment as quick as possible." %}
                        {% endif %}
                    </div>
                </td>
            </tr>
            </tbody>
        </table>

        <nav class="mt-3">
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-description"
                   role="tab" aria-controls="nav-home" aria-selected="true">{% trans "Description" %}</a>
                <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-submission"
                   role="tab" aria-controls="nav-profile" aria-selected="false">{% trans "Submission" %}</a>
            </div>
        </nav>

        <div class="tab-content" id="nav-tabContent">
            <div class="assignment-description tab-pane fade show active" id="nav-description" role="tabpanel"
                 aria-labelledby="nav-home-tab">
                <div class='row mt-2'>
                    <div class='col-lg-9'>
                        <div class="markdown-body">{{ assignment.description | safe }}</div>
                    </div>
                    <div class="col-lg-3 mt-4 mt-lg-0">
                        <div class="alert-submit-guide alert alert-secondary" role="alert">
                            <h4>{% trans "How to submit?" %}</h4>
                            <p>{% trans "When you are ready, you can submit your solution at the 'My submission' tab." %}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="assignment-submission tab-pane fade" id="nav-submission" role="tabpanel"
                 aria-labelledby="nav-profile-tab">
                <div class='row pt-3'>
                    <div class="col-md-12">
                        <button type="button" class="btn btn-primary" data-toggle="modal"
                                data-target="#staticBackdrop">{% trans "Create submission" %}</button>
                    </div>
                    <!-- Modal -->
                    <div class="modal fade" id="staticBackdrop" data-backdrop="static" tabindex="-1" role="dialog"
                         aria-labelledby="staticBackdropLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title"
                                        id="staticBackdropLabel">{% trans "Create submission" %}</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="custom-file">
                                        <input type="file" class="custom-file-input" id="customFile">
                                        <label class="custom-file-label"
                                               for="customFile">{% trans "Choose file" %}</label>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                            data-dismiss="modal">{% trans "Close" %}</button>
                                    <button type="button" class="btn btn-primary">{% trans "Submit" %}</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class='row pt-3'>
                    <div class="col-md-12">
                        <h3>{% trans "Your submissions" %}</h3>
                        <div class="grade-history container-fluid mt-4">
                            <div class="row header">
                                <div class="col-7 text-left">
                                    {% trans "Date" %}
                                </div>
                                <div class="col-2 text-right">
                                    {% trans "Score" %}
                                </div>
                                <div class="col-3 text-center">
                                    {% trans "Passed?" %}
                                </div>
                            </div>
                            {% for submission in submissions %}
                                <div class="row submission-row">
                                    <button class='col col-7 text-left nostyle grade-expand' type="button"
                                            data-toggle="collapse" data-target="#collapsesubmission{{ submission.id }}"
                                            aria-expanded="false" aria-controls="collapseExample">
                                        <svg class="bi bi-chevron-right" width="1em" height="1em"
                                             viewBox="0 0 20 20" fill="currentColor"
                                             xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd"
                                                  d="M6.646 3.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L12.293 10 6.646 4.354a.5.5 0 010-.708z"
                                                  clip-rule="evenodd"></path>
                                        </svg>
                                        <svg class="bi bi-chevron-down" width="1em" height="1em"
                                             viewBox="0 0 20 20" fill="currentColor"
                                             xmlns="http://www.w3.org/2000/svg" style="display: none">
                                            <path fill-rule="evenodd"
                                                  d="M3.646 6.646a.5.5 0 01.708 0L10 12.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z"
                                                  clip-rule="evenodd"></path>
                                        </svg>
                                        <span>{{ submission.submited_time | date:"DATETIME_FORMAT" }}</span>
                                    </button>
                                    <div class="col col-2 text-right">
                                        {{ submission.grade }}/{{ submission.total_grade }}
                                    </div>
                                    <div class="col col-3 text-center">
                                        {{ submission.is_passed|yesno:"Yes, No" }}
                                    </div>
                                </div>
                                <div class="collapse" id="collapsesubmission{{ submission.id }}">
                                    {% for gradeunit in submission.gradeunit_set.all %}
                                        <div class="row detail-row">
                                            <div class="detail-title col col-7 text-left text-secondary">
                                                {{ gradeunit.name }}
                                            </div>
                                            <div class="col col-2 text-right text-secondary">
                                                {{ gradeunit.grade }}/{{ gradeunit.total_grade }}
                                            </div>
                                            <div class="col col-3 text-center text-secondary">
                                                <a class="nostyle" data-toggle="collapse"
                                                   href="#collapsegradeunit{{ gradeunit.pk }}" role="button"
                                                   aria-expanded="false"
                                                   aria-controls="collapseExample">
                                                    <span>{% trans "Show Grading Report" %}</span>
                                                </a>
                                            </div>
                                        </div>
                                        <div class="grade-output collapse" id="collapsegradeunit{{ gradeunit.pk }}">
                                            <div class="card rounded-0 mt-2">
                                                <div class="card-header">
                                                    <a class="btn" href="#">lexical.zip</a>
                                                    <a class="btn float-right" href="#">{% trans "Download" %}</a>
                                                </div>
                                                <div class="card-body">
                                                    <p class="card-text">{{ gradeunit.grade_report }}</p>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="border-top mt-5">
            <button type="button" class="btn pl-0">
                <svg class="bi bi-chevron-left" width="1em" height="1em" viewBox="0 0 20 20"
                     fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                          d="M13.354 3.646a.5.5 0 010 .708L7.707 10l5.647 5.646a.5.5 0 01-.708.708l-6-6a.5.5 0 010-.708l6-6a.5.5 0 01.708 0z"
                          clip-rule="evenodd"></path>
                </svg>
                {% trans "Previous" %}
            </button>
            <button type="button" class="btn pr-0 float-right">
                {% trans "Next" %}
                <svg class="bi bi-chevron-right" width="1em" height="1em" viewBox="0 0 20 20"
                     fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                          d="M6.646 3.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L12.293 10 6.646 4.354a.5.5 0 010-.708z"
                          clip-rule="evenodd"></path>
                </svg>
            </button>
        </footer>
    </div>
{% endblock %}